<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>520 â™¥ å¤§åŸå°çˆ±ï¼ˆæç®€è‡ªæ£€ç‰ˆï¼‰</title>
<style>
  :root { --bg:#0f172a; --fg:#f8fafc; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family: ui-monospace, Menlo, Consolas, monospace;}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;
    justify-content:center;gap:16px;padding:16px;box-sizing:border-box}
  pre{white-space:pre;margin:0;font-size:20px;line-height:1.1;text-align:center;
    transform-origin:center center}
  .btn{padding:10px 14px;border:none;border-radius:999px;cursor:pointer;
    background:rgba(225,29,72,.95);color:#fff;font:14px/1 system-ui,sans-serif;
    box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .tip{position:fixed;left:10px;bottom:10px;right:10px;z-index:9;
    font:12px/1.4 system-ui,sans-serif;opacity:.9}
  .tip b{color:#ffb4b4}
  audio{width:min(420px,90vw)}
</style>
</head>
<body>
<div class="wrap">
  <pre id="heart"></pre>
  <h2 style="margin:0">ğŸµ ç‹åŠ›å® - å¤§åŸå°çˆ±</h2>

  <!-- åŸç”Ÿæ’­æ”¾å™¨ï¼ˆé›¶ä¾èµ–ï¼‰ -->
  <audio id="player" controls preload="auto" playsinline webkit-playsinline></audio>

  <!-- é¦–æ¬¡ç‚¹å‡»è§£é”æ’­æ”¾ï¼ˆç§»åŠ¨ç«¯å¿…é¡»ï¼‰ -->
  <button id="playBtn" class="btn">â–¶ æ’­æ”¾ / ç»§ç»­æ’­æ”¾</button>
</div>

<!-- å¯è§æ—¥å¿—/é”™è¯¯æç¤º -->
<div id="tip" class="tip">ğŸ” è‡ªæ£€ï¼šé¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…æŒ‰é’®ç‚¹å‡»ã€‚</div>

<script>
/* ========== 1) ç”» 520 çˆ±å¿ƒ + è‡ªé€‚åº”ç¼©æ”¾ ========== */
const H=28,W=56,S=12.0,GLYPH="520";
function drawHeart(){
  const pre=document.getElementById("heart"); let out="";
  for(let y=H;y>=-H;y--){
    let line=""; for(let x=-W;x<=W;x++){
      const X=x/S, Y=y/S;
      const inH=Math.pow(X*X+Y*Y-1,3)-X*X*Math.pow(Y,3)<=0;
      line+=inH?GLYPH:" ".repeat(GLYPH.length);
    }
    out+=line+"\n";
  }
  pre.textContent=out; fitToViewport();
}
function fitToViewport(){
  const pre=document.getElementById("heart");
  pre.style.transform="scale(1)";
  requestAnimationFrame(()=>{
    const r=pre.getBoundingClientRect();
    const vw=window.innerWidth-20, vh=window.innerHeight-180; // ç»™æ’­æ”¾å™¨å’ŒæŒ‰é’®ç•™ç©ºé—´
    const scale=Math.min(1, vw/r.width, vh/r.height);
    pre.style.transform=`scale(${scale})`;
  });
}
window.addEventListener("resize",fitToViewport);
drawHeart();

/* ========== 2) éŸ³é¢‘ï¼šå…ˆç”¨ä½ çš„ç›´é“¾ï¼Œå¤±è´¥åˆ™åˆ‡æ¢æµ‹è¯•éŸ³é¢‘ ========== */
const tip = document.getElementById('tip');
function log(s){ tip.innerHTML = s; }

const player = document.getElementById('player');
const playBtn = document.getElementById('playBtn');

// æŠŠè¿™è¡Œæ›¿æ¢æˆä½ çš„ mp3 ç›´é“¾ï¼ˆGitHub Pagesï¼‰
const YOUR_MP3 = 'https://martinmax0711.github.io/music/dachengxiaai.mp3';
// å¤‡ç”¨æµ‹è¯•éŸ³é¢‘ï¼ˆéªŒè¯ä»£ç /æµè§ˆå™¨æ˜¯å¦æ­£å¸¸ï¼‰
const TEST_MP3 = 'https://www.w3schools.com/html/horse.mp3';

async function tryLoad(src){
  player.src = src;
  player.load();
  log('ğŸ§ æ­£åœ¨åŠ è½½éŸ³é¢‘ï¼š<code>'+src+'</code>');
  // ç®€å•ç­‰ä¸€ä¸‹å†æ£€æŸ¥æ˜¯å¦èƒ½æ’­æ”¾
  await new Promise(r=>setTimeout(r, 300));
  if (player.networkState === 3 /*NETWORK_NO_SOURCE*/){
    throw new Error('æ— æ³•åŠ è½½éŸ³é¢‘æºï¼ˆå¯èƒ½æ˜¯é“¾æ¥é”™è¯¯/å¤§å°å†™ä¸åŒ¹é…/æ— æƒé™ï¼‰');
  }
}

(async () => {
  try{
    await tryLoad(YOUR_MP3);
    log('âœ… å·²åŠ è½½ä½ çš„éŸ³é¢‘ï¼ˆè‹¥æ— å£°ï¼Œè¯·ç‚¹æŒ‰é’®æˆæƒæ’­æ”¾ï¼‰ã€‚');
  }catch(e){
    log('âŒ ä½ çš„éŸ³é¢‘åŠ è½½å¤±è´¥ï¼š<b>'+ (e.message||e) +'</b><br>â–¶ å·²åˆ‡æ¢åˆ°æµ‹è¯•éŸ³é¢‘ä»¥éªŒè¯æ’­æ”¾å™¨ã€‚');
    try{
      await tryLoad(TEST_MP3);
      log('ğŸ§ª æµ‹è¯•éŸ³é¢‘å·²åŠ è½½ã€‚è‹¥èƒ½æ’­æ”¾ï¼Œè¯´æ˜é¡µé¢æ²¡é—®é¢˜ï¼Œæ˜¯ä½ çš„é“¾æ¥ä¸å¯ç”¨ã€‚');
    }catch(e2){
      log('âŒ è¿æµ‹è¯•éŸ³é¢‘éƒ½è½½å…¥å¤±è´¥ï¼š<b>'+ (e2.message||e2) +'</b><br>è¯·æ£€æŸ¥ç½‘ç»œ/HTTPS/æµè§ˆå™¨é™åˆ¶ã€‚');
    }
  }
})();

/* ========== 3) ç‚¹å‡»æ’­æ”¾ï¼ˆç§»åŠ¨ç«¯å¿…éœ€çš„æ‰‹åŠ¿ï¼‰ ========== */
async function unlockAndPlay(){
  try{
    await player.play();               // ç”¨æˆ·æ‰‹åŠ¿è§¦å‘ â†’ iOS/Androidå…è®¸
    playBtn.style.display='none';
    log('ğŸµ æ’­æ”¾ä¸­ï¼ˆåˆ‡åå°å¯èƒ½æš‚åœï¼Œè¿”å›ä¼šç»§ç»­ï¼‰ã€‚');
  }catch(err){
    log('âš ï¸ æ’­æ”¾å¤±è´¥ï¼š<b>'+ (err?.message || err) +'</b><br>è¯·ç¡®è®¤å·²ç‚¹æŒ‰é’®ã€éŸ³é‡æœªé™éŸ³ã€ç³»ç»Ÿæœªåœ¨é™éŸ³æ¨¡å¼ã€‚');
    alert('æ’­æ”¾å¤±è´¥ï¼š'+(err?.message||err));
  }
}
playBtn.addEventListener('click', unlockAndPlay, { once:false });
playBtn.addEventListener('touchend', (e)=>{ e.preventDefault(); unlockAndPlay(); }, { once:false });

// å›åˆ°å‰å°å°è¯•ç»­æ’­
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) player.play().catch(()=>{});
});
</script>
</body>
</html>
