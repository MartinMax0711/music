<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>520 ♥ 大城小爱</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --fg:#f8fafc; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
      font-family: ui-monospace, Menlo, Consolas, monospace;}
    .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;
      justify-content:center;padding:16px;box-sizing:border-box;gap:16px}
    pre{white-space:pre;margin:0;font-size:20px;line-height:1.1;text-align:center}
    #aplayer{width:min(420px,90vw)}
    .tip{font:12px/1.4 system-ui, sans-serif;opacity:.8;text-align:center}
    .err{color:#ffb4b4}
    .hide{display:none}
  </style>

  <!-- APlayer 样式：优先用 jsDelivr，失败时自动切换到 unpkg -->
  <link id="apcss" rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
  <script>
    // CSS 兜底
    document.getElementById('apcss').addEventListener('error', () => {
      const l = document.createElement('link');
      l.rel = 'stylesheet';
      l.href = 'https://unpkg.com/aplayer/dist/APlayer.min.css';
      document.head.appendChild(l);
    });
  </script>
</head>
<body>
  <div class="wrap">
    <!-- 520 爱心 -->
    <pre id="heart"></pre>

    <!-- APlayer 容器 -->
    <div id="aplayer"></div>

    <!-- 可见提示 -->
    <div id="tip" class="tip">🎧 正在加载播放器…</div>

    <!-- 原生 audio 兜底（当 APlayer 加载失败时显示） -->
    <div id="fallback" class="hide">
      <div class="tip err">APlayer 加载失败，使用原生播放器兜底。</div>
      <audio id="nativeAudio" controls loop
             src="https://martinmax0711.github.io/dachengxiaai.mp3"></audio>
    </div>
  </div>

  <!-- APlayer 脚本：优先 jsDelivr，失败自动切到 unpkg -->
  <script>
    function loadScript(src, onload){
      const s = document.createElement('script'); s.src = src; s.onload = onload;
      s.onerror = () => onload(false); document.head.appendChild(s);
    }
    // 先尝试 jsDelivr
    loadScript('https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js', (ok1) => {
      if (ok1 === false || typeof window.APlayer === 'undefined') {
        // 再尝试 unpkg
        loadScript('https://unpkg.com/aplayer/dist/APlayer.min.js', (ok2) => {
          if (ok2 === false || typeof window.APlayer === 'undefined') initFallback();
          else initPlayer();
        });
      } else {
        initPlayer();
      }
    });

    function initPlayer(){
      try {
        const ap = new APlayer({
          container: document.getElementById('aplayer'),
          autoplay: false,    // 浏览器策略限制自动播放
          loop: 'all',
          audio: [{
            name: '大城小爱',
            artist: '王力宏',
            url: 'https://martinmax0711.github.io/dachengxiaai.mp3', // ← 换成你的直链
            cover: 'https://p1.music.126.net/pj-4t3bM7Ob7cP5u2A0uVQ==/109951166195658165.jpg'
          }]
        });
        document.getElementById('tip').textContent = '✅ 播放器已加载（如无声，请点播放）';
      } catch(e){
        initFallback('播放器初始化异常：' + e.message);
      }
    }
    function initFallback(msg){
      const tip = document.getElementById('tip');
      tip.innerHTML = '⚠️ APlayer 加载失败。' + (msg ? ('<br>'+msg) : '');
      document.getElementById('fallback').classList.remove('hide');
    }

    // 画 520 爱心
    const H=28,W=56,S=12.0,GLYPH="520";
    (function drawHeart(){
      const pre = document.getElementById('heart'); let out = "";
      for (let y=H; y>=-H; y--){
        let line=""; for (let x=-W; x<=W; x++){
          const X=x/S, Y=y/S;
          const inH = Math.pow(X*X + Y*Y - 1, 3) - X*X*Math.pow(Y,3) <= 0;
          line += inH ? GLYPH : " ".repeat(GLYPH.length);
        }
        out += line + "\n";
      }
      pre.textContent = out;
    })();
  </script>
</body>
</html>
