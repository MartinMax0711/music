<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>520 â™¥ å¤§åŸå°çˆ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --fg:#f8fafc; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
      font-family: ui-monospace, Menlo, Consolas, monospace;}
    .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;
      justify-content:center;padding:16px;box-sizing:border-box;gap:16px}
    pre{white-space:pre;margin:0;font-size:20px;line-height:1.1;text-align:center}
    #aplayer{width:min(420px,90vw)}
    .tip{font:12px/1.4 system-ui, sans-serif;opacity:.8;text-align:center}
    .err{color:#ffb4b4}
    .hide{display:none}
    /* æ’­æ”¾æŒ‰é’®ï¼ˆå³ä¸‹è§’ï¼‰ */
    #playBtn{
      position:fixed; right:16px; bottom:16px; z-index:50;
      padding:10px 14px; border:none; border-radius:999px; cursor:pointer;
      background:rgba(225,29,72,.95); color:#fff; font:14px/1 system-ui,sans-serif;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
  </style>

  <!-- APlayer æ ·å¼ï¼šå…ˆç”¨ jsDelivrï¼Œå¤±è´¥è‡ªåŠ¨æ¢ unpkg -->
  <link id="apcss" rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
  <script>
    document.getElementById('apcss').addEventListener('error', () => {
      const l = document.createElement('link');
      l.rel = 'stylesheet';
      l.href = 'https://unpkg.com/aplayer/dist/APlayer.min.css';
      document.head.appendChild(l);
    });
  </script>
</head>
<body>
  <div class="wrap">
    <!-- 520 çˆ±å¿ƒ -->
    <pre id="heart"></pre>

    <!-- APlayer å®¹å™¨ -->
    <div id="aplayer"></div>

    <!-- æç¤º/çŠ¶æ€ -->
    <div id="tip" class="tip">ğŸ§ æ­£åœ¨åŠ è½½æ’­æ”¾å™¨â€¦</div>

    <!-- APlayer åŠ è½½å¤±è´¥ â†’ åŸç”Ÿ audio å…œåº• -->
    <div id="fallback" class="hide">
      <div class="tip err">APlayer åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ’­æ”¾å™¨å…œåº•ã€‚</div>
      <audio id="nativeAudio" controls loop
             src="https://martinmax0711.github.io/music/dachengxiaai.mp3"></audio>
    </div>
  </div>

  <!-- æ’­æ”¾æŒ‰é’®ï¼šç‚¹å‡»åæ¢å¤éŸ³é‡å¹¶æ’­æ”¾ -->
  <button id="playBtn">â–¶ æ’­æ”¾å¤§åŸå°çˆ±</button>

  <!-- APlayer è„šæœ¬ï¼šjsDelivr â†’ unpkg å…œåº• -->
  <script>
    function loadScript(src, onload){
      const s = document.createElement('script'); s.src = src; s.onload = onload;
      s.onerror = () => onload(false); document.head.appendChild(s);
    }
    loadScript('https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js', (ok1) => {
      if (ok1 === false || typeof window.APlayer === 'undefined') {
        loadScript('https://unpkg.com/aplayer/dist/APlayer.min.js', (ok2) => {
          if (ok2 === false || typeof window.APlayer === 'undefined') initFallback();
          else initPlayer();
        });
      } else { initPlayer(); }
    });

    let ap=null;
    function initPlayer(){
      try{
        ap = new APlayer({
          container: document.getElementById('aplayer'),
          autoplay: true,     // åˆå§‹é™éŸ³è‡ªåŠ¨æ’­ï¼ˆæµè§ˆå™¨å…è®¸ï¼‰
          volume: 0,          // å…³é”®ï¼šé™éŸ³ï¼Œç­‰ç”¨æˆ·ç‚¹å‡»æŒ‰é’®å†å¼€å£°
          loop: 'all',
          audio: [{
            name: 'å¤§åŸå°çˆ±',
            artist: 'ç‹åŠ›å®',
            url: 'https://martinmax0711.github.io/music/dachengxiaai.mp3', // â† æ¢æˆä½ çš„ç›´é“¾
            cover: 'https://p1.music.126.net/pj-4t3bM7Ob7cP5u2A0uVQ==/109951166195658165.jpg'
          }]
        });
        document.getElementById('tip').textContent = 'âœ… æ’­æ”¾å™¨å·²åŠ è½½ï¼ˆç‚¹å³ä¸‹è§’æŒ‰é’®å¼€å£°éŸ³ï¼‰';
      }catch(e){ initFallback('åˆå§‹åŒ–å¼‚å¸¸ï¼š'+e.message); }
    }
    function initFallback(msg){
      const tip = document.getElementById('tip');
      tip.innerHTML = 'âš ï¸ APlayer åŠ è½½å¤±è´¥ã€‚' + (msg?('<br>'+msg):'');
      document.getElementById('fallback').classList.remove('hide');
    }

    // æ’­æ”¾æŒ‰é’®ï¼šç”¨æˆ·ç‚¹å‡» â†’ æ¢å¤éŸ³é‡å¹¶æ’­æ”¾
    document.getElementById('playBtn').addEventListener('click', async () => {
      try{
        if (ap) {
          ap.volume(1.0, true);   // ç«‹åˆ»æŠŠéŸ³é‡æ¢å¤åˆ° 100%
          await ap.play();
          document.getElementById('playBtn').style.display = 'none';
          document.getElementById('tip').textContent = 'ğŸµ æ’­æ”¾ä¸­';
        } else {
          // å…œåº•ï¼šå¦‚æœç”¨äº†åŸç”Ÿ audio
          const na = document.getElementById('nativeAudio');
          if (na) { await na.play(); document.getElementById('playBtn').style.display='none'; }
        }
      }catch(e){ alert('æ’­æ”¾å¤±è´¥ï¼š'+e.message); }
    });

    // ä»åå°å›åˆ°å‰å°æ—¶å°½é‡ç»­æ’­
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden && ap) ap.play().catch(()=>{});
    });

    // ç”» 520 çˆ±å¿ƒ
    const H=28,W=56,S=12.0,GLYPH="520";
    (function drawHeart(){
      const pre = document.getElementById('heart'); let out = "";
      for (let y=H; y>=-H; y--){
        let line=""; for (let x=-W; x<=W; x++){
          const X=x/S, Y=y/S;
          const inH = Math.pow(X*X + Y*Y - 1, 3) - X*X*Math.pow(Y,3) <= 0;
          line += inH ? GLYPH : " ".repeat(GLYPH.length);
        }
        out += line + "\n";
      }
      pre.textContent = out;
    })();
  </script>
</body>
</html>
