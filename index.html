<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>520 â™¥ å¤§åŸå°çˆ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --fg:#f8fafc; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
      font-family: ui-monospace, Menlo, Consolas, monospace;}
    .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;
      justify-content:center;padding:16px;box-sizing:border-box;gap:16px}
    pre{white-space:pre;margin:0;font-size:20px;line-height:1.1;text-align:center}
    #aplayer{width:min(420px,90vw)}
    .tip{font:12px/1.4 system-ui, sans-serif;opacity:.8;text-align:center}
    .err{color:#ffb4b4}
    .hide{display:none}
  </style>

  <!-- APlayer æ ·å¼ï¼šä¼˜å…ˆç”¨ jsDelivrï¼Œå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° unpkg -->
  <link id="apcss" rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
  <script>
    // CSS å…œåº•
    document.getElementById('apcss').addEventListener('error', () => {
      const l = document.createElement('link');
      l.rel = 'stylesheet';
      l.href = 'https://unpkg.com/aplayer/dist/APlayer.min.css';
      document.head.appendChild(l);
    });
  </script>
</head>
<body>
  <div class="wrap">
    <!-- 520 çˆ±å¿ƒ -->
    <pre id="heart"></pre>

    <!-- APlayer å®¹å™¨ -->
    <div id="aplayer"></div>

    <!-- å¯è§æç¤º -->
    <div id="tip" class="tip">ğŸ§ æ­£åœ¨åŠ è½½æ’­æ”¾å™¨â€¦</div>

    <!-- åŸç”Ÿ audio å…œåº•ï¼ˆå½“ APlayer åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºï¼‰ -->
    <div id="fallback" class="hide">
      <div class="tip err">APlayer åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿæ’­æ”¾å™¨å…œåº•ã€‚</div>
      <audio id="nativeAudio" controls loop
             src="https://martinmax0711.github.io/dachengxiaai.mp3"></audio>
    </div>
  </div>

  <!-- APlayer è„šæœ¬ï¼šä¼˜å…ˆ jsDelivrï¼Œå¤±è´¥è‡ªåŠ¨åˆ‡åˆ° unpkg -->
  <script>
    function loadScript(src, onload){
      const s = document.createElement('script'); s.src = src; s.onload = onload;
      s.onerror = () => onload(false); document.head.appendChild(s);
    }
    // å…ˆå°è¯• jsDelivr
    loadScript('https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js', (ok1) => {
      if (ok1 === false || typeof window.APlayer === 'undefined') {
        // å†å°è¯• unpkg
        loadScript('https://unpkg.com/aplayer/dist/APlayer.min.js', (ok2) => {
          if (ok2 === false || typeof window.APlayer === 'undefined') initFallback();
          else initPlayer();
        });
      } else {
        initPlayer();
      }
    });

    function initPlayer(){
      try {
        const ap = new APlayer({
          container: document.getElementById('aplayer'),
          autoplay: false,    // æµè§ˆå™¨ç­–ç•¥é™åˆ¶è‡ªåŠ¨æ’­æ”¾
          loop: 'all',
          audio: [{
            name: 'å¤§åŸå°çˆ±',
            artist: 'ç‹åŠ›å®',
            url: 'https://martinmax0711.github.io/dachengxiaai.mp3', // â† æ¢æˆä½ çš„ç›´é“¾
            cover: 'https://p1.music.126.net/pj-4t3bM7Ob7cP5u2A0uVQ==/109951166195658165.jpg'
          }]
        });
        document.getElementById('tip').textContent = 'âœ… æ’­æ”¾å™¨å·²åŠ è½½ï¼ˆå¦‚æ— å£°ï¼Œè¯·ç‚¹æ’­æ”¾ï¼‰';
      } catch(e){
        initFallback('æ’­æ”¾å™¨åˆå§‹åŒ–å¼‚å¸¸ï¼š' + e.message);
      }
    }
    function initFallback(msg){
      const tip = document.getElementById('tip');
      tip.innerHTML = 'âš ï¸ APlayer åŠ è½½å¤±è´¥ã€‚' + (msg ? ('<br>'+msg) : '');
      document.getElementById('fallback').classList.remove('hide');
    }

    // ç”» 520 çˆ±å¿ƒ
    const H=28,W=56,S=12.0,GLYPH="520";
    (function drawHeart(){
      const pre = document.getElementById('heart'); let out = "";
      for (let y=H; y>=-H; y--){
        let line=""; for (let x=-W; x<=W; x++){
          const X=x/S, Y=y/S;
          const inH = Math.pow(X*X + Y*Y - 1, 3) - X*X*Math.pow(Y,3) <= 0;
          line += inH ? GLYPH : " ".repeat(GLYPH.length);
        }
        out += line + "\n";
      }
      pre.textContent = out;
    })();
  </script>
</body>
</html>
