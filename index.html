<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>520 ♥ 大城小爱（极简自检版）</title>
<style>
  :root { --bg:#0f172a; --fg:#f8fafc; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family: ui-monospace, Menlo, Consolas, monospace;}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;
    justify-content:center;gap:16px;padding:16px;box-sizing:border-box}
  pre{white-space:pre;margin:0;font-size:20px;line-height:1.1;text-align:center;
    transform-origin:center center}
  .btn{padding:10px 14px;border:none;border-radius:999px;cursor:pointer;
    background:rgba(225,29,72,.95);color:#fff;font:14px/1 system-ui,sans-serif;
    box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .tip{position:fixed;left:10px;bottom:10px;right:10px;z-index:9;
    font:12px/1.4 system-ui,sans-serif;opacity:.9}
  .tip b{color:#ffb4b4}
  audio{width:min(420px,90vw)}
</style>
</head>
<body>
<div class="wrap">
  <pre id="heart"></pre>
  <h2 style="margin:0">🎵 王力宏 - 大城小爱</h2>

  <!-- 原生播放器（零依赖） -->
  <audio id="player" controls preload="auto" playsinline webkit-playsinline></audio>

  <!-- 首次点击解锁播放（移动端必须） -->
  <button id="playBtn" class="btn">▶ 播放 / 继续播放</button>
</div>

<!-- 可见日志/错误提示 -->
<div id="tip" class="tip">🔎 自检：页面已加载，等待按钮点击。</div>

<script>
/* ========== 1) 画 520 爱心 + 自适应缩放 ========== */
const H=28,W=56,S=12.0,GLYPH="520";
function drawHeart(){
  const pre=document.getElementById("heart"); let out="";
  for(let y=H;y>=-H;y--){
    let line=""; for(let x=-W;x<=W;x++){
      const X=x/S, Y=y/S;
      const inH=Math.pow(X*X+Y*Y-1,3)-X*X*Math.pow(Y,3)<=0;
      line+=inH?GLYPH:" ".repeat(GLYPH.length);
    }
    out+=line+"\n";
  }
  pre.textContent=out; fitToViewport();
}
function fitToViewport(){
  const pre=document.getElementById("heart");
  pre.style.transform="scale(1)";
  requestAnimationFrame(()=>{
    const r=pre.getBoundingClientRect();
    const vw=window.innerWidth-20, vh=window.innerHeight-180; // 给播放器和按钮留空间
    const scale=Math.min(1, vw/r.width, vh/r.height);
    pre.style.transform=`scale(${scale})`;
  });
}
window.addEventListener("resize",fitToViewport);
drawHeart();

/* ========== 2) 音频：先用你的直链，失败则切换测试音频 ========== */
const tip = document.getElementById('tip');
function log(s){ tip.innerHTML = s; }

const player = document.getElementById('player');
const playBtn = document.getElementById('playBtn');

// 把这行替换成你的 mp3 直链（GitHub Pages）
const YOUR_MP3 = 'https://martinmax0711.github.io/music/dachengxiaai.mp3';
// 备用测试音频（验证代码/浏览器是否正常）
const TEST_MP3 = 'https://www.w3schools.com/html/horse.mp3';

async function tryLoad(src){
  player.src = src;
  player.load();
  log('🎧 正在加载音频：<code>'+src+'</code>');
  // 简单等一下再检查是否能播放
  await new Promise(r=>setTimeout(r, 300));
  if (player.networkState === 3 /*NETWORK_NO_SOURCE*/){
    throw new Error('无法加载音频源（可能是链接错误/大小写不匹配/无权限）');
  }
}

(async () => {
  try{
    await tryLoad(YOUR_MP3);
    log('✅ 已加载你的音频（若无声，请点按钮授权播放）。');
  }catch(e){
    log('❌ 你的音频加载失败：<b>'+ (e.message||e) +'</b><br>▶ 已切换到测试音频以验证播放器。');
    try{
      await tryLoad(TEST_MP3);
      log('🧪 测试音频已加载。若能播放，说明页面没问题，是你的链接不可用。');
    }catch(e2){
      log('❌ 连测试音频都载入失败：<b>'+ (e2.message||e2) +'</b><br>请检查网络/HTTPS/浏览器限制。');
    }
  }
})();

/* ========== 3) 点击播放（移动端必需的手势） ========== */
async function unlockAndPlay(){
  try{
    await player.play();               // 用户手势触发 → iOS/Android允许
    playBtn.style.display='none';
    log('🎵 播放中（切后台可能暂停，返回会继续）。');
  }catch(err){
    log('⚠️ 播放失败：<b>'+ (err?.message || err) +'</b><br>请确认已点按钮、音量未静音、系统未在静音模式。');
    alert('播放失败：'+(err?.message||err));
  }
}
playBtn.addEventListener('click', unlockAndPlay, { once:false });
playBtn.addEventListener('touchend', (e)=>{ e.preventDefault(); unlockAndPlay(); }, { once:false });

// 回到前台尝试续播
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) player.play().catch(()=>{});
});
</script>
</body>
</html>
