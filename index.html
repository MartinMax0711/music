<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>520 ♥ 大城小爱</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --fg:#f8fafc; }
    html,body{
      height:100%; margin:0;
      background:var(--bg); color:var(--fg);
      font-family: ui-monospace, Menlo, Consolas, monospace;
    }
    .wrap{
      flex:1; display:flex;
      align-items:center; justify-content:center;
      overflow:hidden; padding:16px;
      box-sizing:border-box; flex-direction:column; gap:16px;
    }
    pre{
      white-space:pre; margin:0;
      font-size:20px; line-height:1.1;
      text-align:center;
      transform-origin:center center; /* 以中心缩放 */
    }
    #aplayer{width:min(420px,90vw)}
    .tip{font:12px/1.4 system-ui, sans-serif;opacity:.8;text-align:center}
    .err{color:#ffb4b4}
    .hide{display:none}
    /* 播放按钮 */
    #playBtn{
      position:fixed; right:16px; bottom:16px; z-index:50;
      padding:10px 14px; border:none; border-radius:999px; cursor:pointer;
      background:rgba(225,29,72,.95); color:#fff; font:14px/1 system-ui,sans-serif;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
  </style>
  <!-- APlayer 样式 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
</head>
<body>
  <div class="wrap">
    <!-- 520 爱心 -->
    <pre id="heart"></pre>
    <!-- APlayer 容器 -->
    <div id="aplayer"></div>
    <!-- 提示/状态 -->
    <div id="tip" class="tip">🎧 正在加载播放器…</div>
  </div>

  <!-- 播放按钮 -->
  <button id="playBtn">▶ 播放大城小爱</button>

  <!-- APlayer 脚本 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
  <script>
    // 画 520 爱心
    const H=28,W=56,S=12.0,GLYPH="520";
    function drawHeart(){
      const pre=document.getElementById("heart"); let out="";
      for(let y=H;y>=-H;y--){
        let line=""; for(let x=-W;x<=W;x++){
          const X=x/S, Y=y/S;
          const inH=Math.pow(X*X+Y*Y-1,3)-X*X*Math.pow(Y,3)<=0;
          line+=inH?GLYPH:" ".repeat(GLYPH.length);
        }
        out+=line+"\n";
      }
      pre.textContent=out;
      fitToViewport();
    }
    function fitToViewport(){
      const pre=document.getElementById("heart");
      pre.style.transform="scale(1)";
      requestAnimationFrame(()=>{
        const rect=pre.getBoundingClientRect();
        const vw=window.innerWidth-20;
        const vh=window.innerHeight-150;
        const scale=Math.min(1,vw/rect.width,vh/rect.height);
        pre.style.transform=`scale(${scale})`;
      });
    }
    window.addEventListener("resize",fitToViewport);
    drawHeart();

    // 初始化 APlayer
    const ap=new APlayer({
      container:document.getElementById('aplayer'),
      autoplay:true,  // 开启自动播放（但因浏览器限制会静音）
      volume:0,       // 初始静音
      loop:'all',
      audio:[{
        name:'大城小爱',
        artist:'王力宏',
        url:'https://martinmax0711.github.io/dachengxiaai.mp3', // 换成你的mp3直链
        cover:'https://p1.music.126.net/pj-4t3bM7Ob7cP5u2A0uVQ==/109951166195658165.jpg'
      }]
    });
    document.getElementById('tip').textContent='✅ 播放器已加载（点击按钮开声音）';

    // 播放按钮：恢复音量并播放
    document.getElementById('playBtn').addEventListener('click',async()=>{
      try{
        ap.volume(1.0,true);
        await ap.play();
        document.getElementById('playBtn').style.display='none';
        document.getElementById('tip').textContent='🎵 播放中';
      }catch(e){alert('播放失败：'+e.message);}
    });
  </script>
</body>
</html>
