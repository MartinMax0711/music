<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>520 â™¥ å¤§åŸå°çˆ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --fg:#f8fafc; }
    html,body{
      height:100%; margin:0;
      background:var(--bg); color:var(--fg);
      font-family: ui-monospace, Menlo, Consolas, monospace;
    }
    .wrap{
      flex:1; display:flex;
      align-items:center; justify-content:center;
      overflow:hidden; padding:16px;
      box-sizing:border-box; flex-direction:column; gap:16px;
    }
    pre{
      white-space:pre; margin:0;
      font-size:20px; line-height:1.1;
      text-align:center;
      transform-origin:center center; /* ä»¥ä¸­å¿ƒç¼©æ”¾ */
    }
    #aplayer{width:min(420px,90vw)}
    .tip{font:12px/1.4 system-ui, sans-serif;opacity:.8;text-align:center}
    .err{color:#ffb4b4}
    .hide{display:none}
    /* æ’­æ”¾æŒ‰é’® */
    #playBtn{
      position:fixed; right:16px; bottom:16px; z-index:50;
      padding:10px 14px; border:none; border-radius:999px; cursor:pointer;
      background:rgba(225,29,72,.95); color:#fff; font:14px/1 system-ui,sans-serif;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
  </style>
  <!-- APlayer æ ·å¼ CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
</head>
<body>
  <div class="wrap">
    <!-- 520 çˆ±å¿ƒ -->
    <pre id="heart"></pre>
    <!-- APlayer å®¹å™¨ -->
    <div id="aplayer"></div>
    <!-- æç¤º/çŠ¶æ€ -->
    <div id="tip" class="tip">ğŸ§ æ­£åœ¨åŠ è½½æ’­æ”¾å™¨â€¦</div>
  </div>

  <!-- æ’­æ”¾æŒ‰é’® -->
  <button id="playBtn">â–¶ æ’­æ”¾å¤§åŸå°çˆ±</button>

  <!-- APlayer è„šæœ¬ CDN -->
  <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
  <script>
    // ç”» 520 çˆ±å¿ƒ
    const H=28,W=56,S=12.0,GLYPH="520";
    function drawHeart(){
      const pre=document.getElementById("heart"); let out="";
      for(let y=H;y>=-H;y--){
        let line=""; for(let x=-W;x<=W;x++){
          const X=x/S, Y=y/S;
          const inH=Math.pow(X*X+Y*Y-1,3)-X*X*Math.pow(Y,3)<=0;
          line+=inH?GLYPH:" ".repeat(GLYPH.length);
        }
        out+=line+"\n";
      }
      pre.textContent=out;
      fitToViewport();
    }
    function fitToViewport(){
      const pre=document.getElementById("heart");
      pre.style.transform="scale(1)";
      requestAnimationFrame(()=>{
        const rect=pre.getBoundingClientRect();
        const vw=window.innerWidth-20;
        const vh=window.innerHeight-150;
        const scale=Math.min(1,vw/rect.width,vh/rect.height);
        pre.style.transform=`scale(${scale})`;
      });
    }
    window.addEventListener("resize",fitToViewport);
    drawHeart();

    // åˆå§‹åŒ– APlayer
    const ap=new APlayer({
      container:document.getElementById('aplayer'),
      autoplay:true,  // å¼€å¯è‡ªåŠ¨æ’­æ”¾ï¼ˆä½†å› æµè§ˆå™¨é™åˆ¶ä¼šé™éŸ³ï¼‰
      volume:0,       // åˆå§‹é™éŸ³
      loop:'all',
      audio:[{
        name:'å¤§åŸå°çˆ±',
        artist:'ç‹åŠ›å®',
        url:'https://martinmax0711.github.io/dachengxiaai.mp3', // æ¢æˆä½ çš„mp3ç›´é“¾
        cover:'https://p1.music.126.net/pj-4t3bM7Ob7cP5u2A0uVQ==/109951166195658165.jpg'
      }]
    });
    document.getElementById('tip').textContent='âœ… æ’­æ”¾å™¨å·²åŠ è½½ï¼ˆç‚¹å‡»æŒ‰é’®å¼€å£°éŸ³ï¼‰';

    // æ’­æ”¾æŒ‰é’®ï¼šæ¢å¤éŸ³é‡å¹¶æ’­æ”¾
    document.getElementById('playBtn').addEventListener('click',async()=>{
      try{
        ap.volume(1.0,true);
        await ap.play();
        document.getElementById('playBtn').style.display='none';
        document.getElementById('tip').textContent='ğŸµ æ’­æ”¾ä¸­';
      }catch(e){alert('æ’­æ”¾å¤±è´¥ï¼š'+e.message);}
    });
  </script>
</body>
</html>
